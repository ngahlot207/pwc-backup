@Istest
public class CommercialIssueTest {
    
    @isTest
    public static void testGenerateMethod() {
        
        LoanAppl__c la = TestDataFactory.createLoanApplication(true);
        
        Applicant__c app = TestDataFactory.createSingleApplicant(true,la.id);
        
        
        Bureau__c br=new Bureau__c();
        br.LoanApp__c=La.id;
        br.Applicant__c=app.id;
        br.AckId__c=123456;
        br.IsLatest__c=true;
        br.BureauAPI__c='Commercial';
        insert br;
        
        IntgMsg__c intgMsg =new IntgMsg__c();
        intgMsg.Name='Commercial Issue Request';
        intgMsg.BU__c='HL / STL';
        intgMsg.Status__c='New';
        intgMsg.MStatus__c='Blank';
        intgMsg.RefObj__c='Applicant__c';
        intgMsg.RefId__c = app.Id;
        intgMsg.Resp__c='';
        intgMsg.Svc__c='Commercial Issue Request';
        insert intgMsg;
        
        
        
        ContentVersion contentVersion = new ContentVersion();
        contentVersion.VersionData =blob.valueof('{"STATUS":"COMPLETED","ACKNOWLEDGEMENT-ID":9154008,"HEADER":{"CUST-ID":"A-001257","APPLICATION-ID":"LAN-0702","RESPONSE-TYPE":"RESPONSE","REQUEST-RECEIVED-TIME":"21122023 10:43:14"},"FINISHED":[{"TRACKING-ID":7363730,"STATUS":"SUCCESS","PRODUCT":"CCIR","JSON-RESPONSE-OBJECT":{"responseReport":{"reportHeaderRec":{"reportOrderedBy":"NB68420001_CMMUATC2C3","memberReferenceNumber":"","inquiryPurpose":"Others","reportOrderDate":"21-DEC-2023","daysPasswordToExpire":"","reportOrderNumber":"W-26120617","memberDetails":"FEDBANK FINANCIAL SERVICES LIMITED","applicationReferenceNumber":"9154008"},"reportIssuesVec":[],"enquiryInformationRec":{"borrowerName":"MS JORJY INTERNATIONAL PVT LTD","tin":"","dateOfRegistration":"","cin":"","pan":"AAACJ9928K","crn":"","addressVec":{"address":[{"city":"NEWDELHI","pinCode":"110037","state":"NEW DELHI","addressLine":"KH 33 1 DAYA COMPLEX RANGPURI KH 33 1 DAYA COMPLEX RANGPURI"}]},"addressCount":"1"},"productSec":{"relationshipDetailsVec":{"relationshipDetails":[{"relationshipInformation":{"relatedType":"Resident Indian Individual","name":"SANJAY KALRA","percentageOfControl":"0.00%","relationship":"Promoter Director"},"borrwerAddressContactDetails":{"address":"4 BUM DLE,PHASE II,GURGAON,GURGAON,Haryana,121001"},"relationshipHeader":"Relationship 1"}],"relationshipDispute":{"disputeRemarks":"","disputeRemarksDate":""},"message":""},"enquiryDetailsInLast24MonthVec":{"enquiriesDispute":{"disputeRemarks":"","disputeRemarksDate":""},"enquiryDetailsInLast24Month":[{"enquiryPurpose":"Others","creditLender":"FEDBANK FINANCIAL SERVICES LIMITED","enquiryDt":"20-DEC-2023","enquiryAmt":"1000000"}],"message":""},"derogatoryInformationSec":{"messageOfRelatedParties":"No Derogatory Information reported about the Related Party/Guarantor","messageOfRelatedPartiesOutsideInstitution":"","messageOfGuarantedParties":"No reporting done on Credit Facilities Guaranteed by the Borrower","derogatoryInformationOnRelatedPartiesOrGuarantorsOfBorrowerSec":{"total":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"yourInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"outsideInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}}},"derogatoryInformationBorrower":{"total":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"10334716","numberOfSuitFiled":"9"},"dishonoredCheque":"5","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"3"},"overdueCF":{"amt":"62757350","numberOfSuitFiled":"12"}},"yourInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"outsideInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"10334716","numberOfSuitFiled":"9"},"dishonoredCheque":"5","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"3"},"overdueCF":{"amt":"62757350","numberOfSuitFiled":"12"}}},"messageOfRelatedPartiesYourInstitution":"","messageOfBorrowerYourInstitution":"No Derogatory Information reported about the Borrower by Your Institution","messageOfBorrowerOutsideInstitution":"","message":"","messageOfBorrower":""},"locationDetailsSec":{"contactNumber":"91-11-26810557,011-26812220,011-29815888,011-26810557,25065540,11-25065541,1125065541,011-981515099,25065541,1163442 68,2681055,268122200000,+91-123456789,+91-8079076665,+91-8408980037,+91-8907654321,+91-7569406586,+91-9912306214,+91-9893849389,+91-9148125609,+91-7032443444,+91-981515099,+91-8382928328,+91-9994086679,+91-7670000984,+91-919810540636,+91-9467547546,+91-9810041777,+91-9999999999,+91-9036000301,+91-9871873327,+91-9810540636,+91-7973124432,+91-8287276262,+91-9879585203,+91-8684919930,2681222000002357204,2357204,26810557,9512424533392357204,951242453339 2357204,2681222000002387034,268105570000 2387034,26810577,2229292 9829063782,0141  -3151555                                                ,0141  -2229292                                                ,0141  -5125539                                                ,0141  -5125539 9829063782                                     ,0141  -2229292 9828053624                                     ,0141  -3151555 9829063782,22292929829063782,51252749829063782,911242387034,911242357204,2357204,2681055,2681055,2357204,2681055,0124  -2357204                                                ,011   -22545680,26810557,25065540,+91-9829063782,+91-9828053624,+91-9619676719","locationInformationVec":{"locationInformation":[{"numberOfInstitutions":"1","address":"LOWER GROUND FLOOR, O-47, LAJPAT NAGAR-II, LAJPAT NAGAR-II, SOUTH DELHIDELHI, 110024,THANE,MAHARASHTRA,400705","lastReportedDate":"14-DEC-2023","firstReportedDate":"14-DEC-2023","borrowerOfficeLocationType":"Registered Office"}]},"message":"","locationDispute":{"disputeRemarks":"","disputeRemarksDate":""}},"suitFiledVec":{"message":"","suitFilled":[{"suitRefNumber":"0000000000000000000000000","suitFilledBy":"Not Disclosed","suitStatus":"Execution of Decree","suitAmt":"0"}]},"borrowerProfileSec":{"borrwerIDDetailsVec":{"lastReportedDate":"31-JUL-2020","borrwerIDDetails":[{"registrationNumber":"AAACJ9928K","cin":"U30007DL1996PTC075726","pan":"AADCP9425C"}]},"borrowerDispute":{"disputeRemarks":"","disputeRemarksDate":""},"borrwerDetails":{"dateOfIncorporation":"24-JAN-1996","businessIndustryType":"Trading","year":"","name":"JORJY INTERNATIONAL PRIVATE LIMITED","businessCategory":"Micro","classOfActivityVec":{"classOfActivity":["Labour recruitment","",""]},"borrowersLegalConstitution":"Private Limited","salesFigure":"","numberOfEmployees":"0"},"borrwerAddressContactDetails":{"address":"43 BIG BAZAAR STREET ANAMALAI . ANAIMALAI,ANAIMALAI,TAMIL NADU,642104","telephoneNumber":"9198105406","mobileNumber":"+91-9865752221","faxNumber":"011-41615940"},"borrowerDelinquencyReportedOnBorrower":{"yourInstitution":{"current":"No","last24Months":"No"},"outsideInstitution":{"current":"Yes","last24Months":"Yes"}},"borrowerDelinquencyReportedOnRSOrGSOftheBorrowerIn24MonthsVec":{"message":"No Delinquency information reported on the Related Parties/Guarantors"}},"rankSec":{"rankVec":[{"exclusionReason":"KB1GR1-No recent NPA but NPA in past and credit relationship experience is older than one business cycle","rankName":"CIBIL MSME Rank","rankValue":"CMR-7"}],"message":""},"creditFacilityDetailsasBorrowerSecVec":{"creditFacilityDetailsasBorrowerSec":[{"creditFacilityCurrentDetailsVec":{"creditFacilityCurrentDetails":{"amount":{"drawingPower":"3000000","suitFiledAmt":"0","sanctionedAmt":"3000000","currency":"INR","outstandingBalance":"6899059"},"cfSerialNumber":"Credit Facility 1","creditFacilityDispute":{"disputeRemarks":"","disputeRemarksDate":""},"lastReportedDate":"09-SEP-2013","cfType":"Unsecured business loan","derivative":"FALSE","cfMember":"Not Disclosed","dates":{"sanctionedDt":"06-FEB-2008"},"accountNumber":"Not Disclosed","assetClassificationDaysPastDueDpd":"Loss","status":"Not a Suit Filed Case,Open,Not Wilful Defaulter"}},"creditFacilityOverdueDetailsVec":{"creditFacilityOverdueDetails":{"DPD1To30Amt":""},"message":"No Amount Overdue Information Reported"},"CFHistoryforACOrDPDupto24MonthsVec":{"CFHistoryforACOrDPDupto24Months":[{"month":"AUG 2013","ACorDPD":"Loss","OSAmount":"2200828"}]},"creditFacilitySecurityDetailsVec":{"message":"No Security Details Reported"},"message":"","creditFacilityGuarantorDetailsVec":{"message":"No Guarantor Details Reported"},"chequeDishounouredDuetoInsufficientFunds":{"message":"No Dishonored Cheques Due To Non Sufficient Funds Reported"}}],"message":""},"creditFacilitiesSummary":{"countOfCreditFacilities":{"noOfCreditGrantors":{"yourBank":"0","total":"0","others":"0"},"noOfCreditFacilities":{"yourBank":"0","total":"0","others":"0"}}},"enquirySummarySec":{"enquiryOutsideInstitution":{"noOfEnquiries":{"month2To3":"73","month4To6":"81","month1":"62","total":"385","month12To24":"91","mostRecentDate":"19-DEC-2023","greaterthan24Month":"20","month7To12":"58"}},"enquiryYourInstitution":{"noOfEnquiries":{"month2To3":"0","month4To6":"0","month1":"8","total":"8","month12To24":"0","mostRecentDate":"20-DEC-2023","greaterthan24Month":"0","month7To12":"0"}},"message":"","enquiryTotal":{"noOfEnquiries":{"month2To3":"73","month4To6":"81","month1":"70","total":"393","month12To24":"91","mostRecentDate":"","greaterthan24Month":"20","month7To12":"58"}}},"creditVisionSec":{},"creditProfileSummarySec":{"total":{"latestCFOpenedDate":"-","totalOutstanding":"129050377","totalCF":"41","delinquentOutstanding":"50461253","delinquentCF":"9","openCF":"22","totalLenders":"14"},"yourInstitution":{"latestCFOpenedDate":"","totalOutstanding":{"borrowerPercentage":"0.00%","borrower":"0","guarantor":"0","guarantorPercentage":"0.00%"},"totalCF":{"borrowerPercentage":"","borrower":"0","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"0.00%","borrower":"0","guarantor":"0","guarantorPercentage":"0.00%"},"message":"No Credit Facility Reported by Your Institution","delinquentCF":{"borrowerPercentage":"","borrower":"0","guarantor":"0","guarantorPercentage":""},"openCF":"0","totalLenders":"0"},"outsideInstitution":{"outsideTotal":{"latestCFOpenedDate":"-","totalOutstanding":{"borrowerPercentage":"100.00%","borrower":"129050377","guarantor":"0","guarantorPercentage":"0.00%"},"totalCF":{"borrowerPercentage":"","borrower":"41","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"100.00%","borrower":"50461253","guarantor":"0","guarantorPercentage":"0.00%"},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"9","guarantor":"0","guarantorPercentage":""},"openCF":"22","totalLenders":"14"},"message":"","otherPublicSectorBanks":{"latestCFOpenedDate":"18-JUN-2009","totalOutstanding":{"borrowerPercentage":"","borrower":"76601121","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"8","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"257991","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"2","guarantor":"0","guarantorPercentage":""},"openCF":"6","totalLenders":"2"},"otherPrivateForeignBanks":{"latestCFOpenedDate":"29-SEP-2008","totalOutstanding":{"borrowerPercentage":"","borrower":"40723917","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"27","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"38477923","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"4","guarantor":"0","guarantorPercentage":""},"openCF":"13","totalLenders":"8"},"NBFCOthers":{"latestCFOpenedDate":"10-NOV-2016","totalOutstanding":{"borrowerPercentage":"","borrower":"11725339","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"6","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"11725339","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"3","guarantor":"0","guarantorPercentage":""},"openCF":"3","totalLenders":"4"}}},"creditRatingSummaryVec":{"message":"No Credit Rating Information Reported"},"creditFacilityDetailsasGuarantorVec":{"message":"No Guaranteed Credit Facility Information Reported"},"oustandingBalanceByCFAndAssetClasificationSec":{"yourInstitution":{"total":{"NONSTDVec":{"sub":{"count":"0","value":"0"},"loss":{"count":"0","value":"0"},"DPD91To180":{"count":"0","value":"0"},"dbt":{"count":"0","value":"0"}},"STDVec":{"DPD61To90":{"count":"0","value":"0"},"DPD1To30":{"count":"0","value":"0"},"DPD0":{"count":"0","value":"0"},"DPD31To60":{"count":"0","value":"0"}}},"termLoan":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"workingCapital":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"forex":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"nonFunded":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}}},"message":"","outsideInstitution":{"total":{"NONSTDVec":{"sub":{"count":"1","value":"1163443"},"loss":{"count":"7","value":"18459484"},"DPD91To180":{"count":"0","value":"0"},"dbt":{"count":"2","value":"257991"}},"STDVec":{"DPD61To90":{"count":"0","value":"0"},"DPD1To30":{"count":"0","value":"0"},"DPD0":{"count":"24","value":"79816385"},"DPD31To60":{"count":"0","value":"0"}}},"termLoan":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"2","value":"2200043"},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"8","value":"5892662"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"3","value":"1227261"},"DPD31To60":{"count":"","value":""}}},"workingCapital":{"NONSTDVec":{"sub":{"count":"1","value":"1163443"},"loss":{"count":"5","value":"16259441"},"DPD91To180":{"count":"","value":""},"dbt":{"count":"2","value":"257991"}},"total":{"count":"29","value":"136839129"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"17","value":"78589124"},"DPD31To60":{"count":"","value":""}}},"forex":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"nonFunded":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"4","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"4","value":"0"},"DPD31To60":{"count":"","value":""}}}}}}}},"BUREAU":"CIBIL"}]}');
        contentVersion.Title = 'response.json';
        contentVersion.PathOnClient = 'response.json';
        insert contentVersion;
        
        Id contentDocumentId = [SELECT ContentDocumentId FROM ContentVersion WHERE Id = :contentVersion.Id LIMIT 1].ContentDocumentId;
        
        ContentDocumentLink contentLink = new ContentDocumentLink();
        contentLink.ContentDocumentId = contentDocumentId;
        contentLink.LinkedEntityId=intgMsg.id;
        contentLink.ShareType = 'V';
        insert contentLink;
        
        List<IntgMsg__c> msg =new List<IntgMsg__c>{intgMsg};
           
                                                 
        //creating integration message for Inprogress
        IntgMsg__c intgMsg2 =new IntgMsg__c();
        intgMsg2.Name='Commercial Issue Request';
        intgMsg2.BU__c='HL / STL';
        intgMsg2.Status__c='New';
        intgMsg2.MStatus__c='Blank';
        intgMsg2.RefObj__c='Applicant__c';
        intgMsg2.RefId__c = app.Id;
        intgMsg2.Resp__c='';
        insert intgMsg2;
        
        ContentVersion contentVersion2 = new ContentVersion();
        contentVersion2.VersionData =blob.valueof('{"STATUS":"IN-PROCESS","ACKNOWLEDGEMENT-ID":9123806,"HEADER":{"CUST-ID":"A-000895","APPLICATION-ID":"LAN-0504","RESPONSE-TYPE":"RESPONSE","REQUEST-RECEIVED-TIME":"05122023 13:02:28"},"IN-PROCESS":[{"TRACKING-ID":7329435,"STATUS":"WAITING","PRODUCT":"CIR","BUREAU":"CIBIL"}]}');
         contentVersion2.Title = 'response.json';
        contentVersion2.PathOnClient = 'response.json';
        insert contentVersion2;
        
        Id contentDocumentId2 = [SELECT ContentDocumentId FROM ContentVersion WHERE Id = :contentVersion2.Id LIMIT 1].ContentDocumentId;
        
        ContentDocumentLink contentLink2 = new ContentDocumentLink();
        contentLink2.ContentDocumentId = contentDocumentId2;
        contentLink2.LinkedEntityId=intgMsg2.id;
        contentLink2.ShareType = 'V';
        insert contentLink2;

       List<IntgMsg__c> responses2 =new List<IntgMsg__c>{intgMsg2};
                                                  
                                                 
                                                 
         //creating integration message for Bureau-error
        IntgMsg__c intgMsg3 =new IntgMsg__c();
        intgMsg3.Name='Commercial Issue Request';
        intgMsg3.BU__c='HL / STL';
        intgMsg3.Status__c='New';
        intgMsg3.MStatus__c='Blank';
        intgMsg3.RefObj__c='Applicant__c';
        intgMsg3.RefId__c = app.Id;
        intgMsg3.Resp__c='';
        insert intgMsg3;
        
        ContentVersion contentVersion3 = new ContentVersion();
        contentVersion3.VersionData =blob.valueof('{"STATUS":"COMPLETED","ACKNOWLEDGEMENT-ID":9023781,"HEADER":{"CUST-ID":"A-000126","APPLICATION-ID":"LAN-0143","RESPONSE-TYPE":"RESPONSE","REQUEST-RECEIVED-TIME":"05102023 18:13:40"},"FINISHED":[{"TRACKING-ID":7222425,"STATUS":"BUREAU-ERROR","PRODUCT":"CIR","JSON-RESPONSE-OBJECT":{"mbrRefNbr":"4930449","invIpOpMedia":"11","timeProcessed":"181338","dateProcessed":"05102023","errorDomainList":[{"errorDescription":"Invalid input/output media","errorCategory":"CR-CIBIL-CIR","errorCode":"E011"}]},"BUREAU":"CIBIL"}]}');
        contentVersion3.Title = 'response.json';
        contentVersion3.PathOnClient = 'response.json';
        insert contentVersion3;
        
        Id contentDocumentId3 = [SELECT ContentDocumentId FROM ContentVersion WHERE Id = :contentVersion3.Id LIMIT 1].ContentDocumentId;
        
        ContentDocumentLink contentLink3 = new ContentDocumentLink();
        contentLink3.ContentDocumentId = contentDocumentId3;
        contentLink3.LinkedEntityId=intgMsg3.id;
        contentLink3.ShareType = 'V';
        insert contentLink3;

       List<IntgMsg__c> responses3 =new List<IntgMsg__c>{intgMsg3};
                                                 
        CommercialIssueRequestGenerator req=new CommercialIssueRequestGenerator();
        req.generate(msg,'Commercial Issue Request','Async');
          
         Test.StartTest();
        CommercialIssueResponseProcessor.process(msg);   
        CommercialIssueResponseProcessor.process(responses2);  
        CommercialIssueResponseProcessor.process(responses3);
         Test.StopTest();                                        
        
      // Create an instance of the BureauQueueable class
        String jsonData = '{"Name": "Cusomer Issue Request", "Status": "New", "MStatus": "Blank", "BU": "HL / STL", "RefId": "a0GC4000000XcBNMA0", "RefObj": "IntgMsg__c", "Svc": "Commercial Issue Request", "ApiVendor": "Lentra", "IsActive": "true"}';
        BureauQueueable bq = new BureauQueueable(jsonData);
        System.enqueueJob(bq);
       
    //wrapper
    string jsonresponse='{"STATUS":"COMPLETED","ACKNOWLEDGEMENT-ID":9154008,"HEADER":{"CUST-ID":"A-001257","APPLICATION-ID":"LAN-0702","RESPONSE-TYPE":"RESPONSE","REQUEST-RECEIVED-TIME":"21122023 10:43:14"},"FINISHED":[{"TRACKING-ID":7363730,"STATUS":"SUCCESS","PRODUCT":"CCIR","JSON-RESPONSE-OBJECT":{"responseReport":{"reportHeaderRec":{"reportOrderedBy":"NB68420001_CMMUATC2C3","memberReferenceNumber":"","inquiryPurpose":"Others","reportOrderDate":"21-DEC-2023","daysPasswordToExpire":"","reportOrderNumber":"W-26120617","memberDetails":"FEDBANK FINANCIAL SERVICES LIMITED","applicationReferenceNumber":"9154008"},"reportIssuesVec":[],"enquiryInformationRec":{"borrowerName":"MS JORJY INTERNATIONAL PVT LTD","tin":"","dateOfRegistration":"","cin":"","pan":"AAACJ9928K","crn":"","addressVec":{"address":[{"city":"NEWDELHI","pinCode":"110037","state":"NEW DELHI","addressLine":"KH 33 1 DAYA COMPLEX RANGPURI KH 33 1 DAYA COMPLEX RANGPURI"}]},"addressCount":"1"},"productSec":{"relationshipDetailsVec":{"relationshipDetails":[{"relationshipInformation":{"relatedType":"Resident Indian Individual","name":"SANJAY KALRA","percentageOfControl":"0.00%","relationship":"Promoter Director"},"borrwerAddressContactDetails":{"address":"4 BUM DLE,PHASE II,GURGAON,GURGAON,Haryana,121001"},"relationshipHeader":"Relationship 1"}],"relationshipDispute":{"disputeRemarks":"","disputeRemarksDate":""},"message":""},"enquiryDetailsInLast24MonthVec":{"enquiriesDispute":{"disputeRemarks":"","disputeRemarksDate":""},"enquiryDetailsInLast24Month":[{"enquiryPurpose":"Others","creditLender":"FEDBANK FINANCIAL SERVICES LIMITED","enquiryDt":"20-DEC-2023","enquiryAmt":"1000000"}],"message":""},"derogatoryInformationSec":{"messageOfRelatedParties":"No Derogatory Information reported about the Related Party/Guarantor","messageOfRelatedPartiesOutsideInstitution":"","messageOfGuarantedParties":"No reporting done on Credit Facilities Guaranteed by the Borrower","derogatoryInformationOnRelatedPartiesOrGuarantorsOfBorrowerSec":{"total":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"yourInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"outsideInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}}},"derogatoryInformationBorrower":{"total":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"10334716","numberOfSuitFiled":"9"},"dishonoredCheque":"5","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"3"},"overdueCF":{"amt":"62757350","numberOfSuitFiled":"12"}},"yourInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"0","numberOfSuitFiled":"0"},"dishonoredCheque":"0","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"0"},"overdueCF":{"amt":"0","numberOfSuitFiled":"0"}},"outsideInstitution":{"settled":{"amt":"0","numberOfSuitFiled":"0"},"writtenOff":{"amt":"10334716","numberOfSuitFiled":"9"},"dishonoredCheque":"5","invoked":{"amt":"0","numberOfSuitFiled":"0"},"wilfulDefault":"0","suitFilled":{"amt":"0","numberOfSuitFiled":"3"},"overdueCF":{"amt":"62757350","numberOfSuitFiled":"12"}}},"messageOfRelatedPartiesYourInstitution":"","messageOfBorrowerYourInstitution":"No Derogatory Information reported about the Borrower by Your Institution","messageOfBorrowerOutsideInstitution":"","message":"","messageOfBorrower":""},"locationDetailsSec":{"contactNumber":"91-11-26810557,011-26812220,011-29815888,011-26810557,25065540,11-25065541,1125065541,011-981515099,25065541,1163442 68,2681055,268122200000,+91-123456789,+91-8079076665,+91-8408980037,+91-8907654321,+91-7569406586,+91-9912306214,+91-9893849389,+91-9148125609,+91-7032443444,+91-981515099,+91-8382928328,+91-9994086679,+91-7670000984,+91-919810540636,+91-9467547546,+91-9810041777,+91-9999999999,+91-9036000301,+91-9871873327,+91-9810540636,+91-7973124432,+91-8287276262,+91-9879585203,+91-8684919930,2681222000002357204,2357204,26810557,9512424533392357204,951242453339 2357204,2681222000002387034,268105570000 2387034,26810577,2229292 9829063782,0141  -3151555                                                ,0141  -2229292                                                ,0141  -5125539                                                ,0141  -5125539 9829063782                                     ,0141  -2229292 9828053624                                     ,0141  -3151555 9829063782,22292929829063782,51252749829063782,911242387034,911242357204,2357204,2681055,2681055,2357204,2681055,0124  -2357204                                                ,011   -22545680,26810557,25065540,+91-9829063782,+91-9828053624,+91-9619676719","locationInformationVec":{"locationInformation":[{"numberOfInstitutions":"1","address":"LOWER GROUND FLOOR, O-47, LAJPAT NAGAR-II, LAJPAT NAGAR-II, SOUTH DELHIDELHI, 110024,THANE,MAHARASHTRA,400705","lastReportedDate":"14-DEC-2023","firstReportedDate":"14-DEC-2023","borrowerOfficeLocationType":"Registered Office"}]},"message":"","locationDispute":{"disputeRemarks":"","disputeRemarksDate":""}},"suitFiledVec":{"message":"","suitFilled":[{"suitRefNumber":"0000000000000000000000000","suitFilledBy":"Not Disclosed","suitStatus":"Execution of Decree","suitAmt":"0"}]},"borrowerProfileSec":{"borrwerIDDetailsVec":{"lastReportedDate":"31-JUL-2020","borrwerIDDetails":[{"registrationNumber":"AAACJ9928K","cin":"U30007DL1996PTC075726","pan":"AADCP9425C"}]},"borrowerDispute":{"disputeRemarks":"","disputeRemarksDate":""},"borrwerDetails":{"dateOfIncorporation":"24-JAN-1996","businessIndustryType":"Trading","year":"","name":"JORJY INTERNATIONAL PRIVATE LIMITED","businessCategory":"Micro","classOfActivityVec":{"classOfActivity":["Labour recruitment","",""]},"borrowersLegalConstitution":"Private Limited","salesFigure":"","numberOfEmployees":"0"},"borrwerAddressContactDetails":{"address":"43 BIG BAZAAR STREET ANAMALAI . ANAIMALAI,ANAIMALAI,TAMIL NADU,642104","telephoneNumber":"9198105406","mobileNumber":"+91-9865752221","faxNumber":"011-41615940"},"borrowerDelinquencyReportedOnBorrower":{"yourInstitution":{"current":"No","last24Months":"No"},"outsideInstitution":{"current":"Yes","last24Months":"Yes"}},"borrowerDelinquencyReportedOnRSOrGSOftheBorrowerIn24MonthsVec":{"message":"No Delinquency information reported on the Related Parties/Guarantors"}},"rankSec":{"rankVec":[{"exclusionReason":"KB1GR1-No recent NPA but NPA in past and credit relationship experience is older than one business cycle","rankName":"CIBIL MSME Rank","rankValue":"CMR-7"}],"message":""},"creditFacilityDetailsasBorrowerSecVec":{"creditFacilityDetailsasBorrowerSec":[{"creditFacilityCurrentDetailsVec":{"creditFacilityCurrentDetails":{"amount":{"drawingPower":"3000000","suitFiledAmt":"0","sanctionedAmt":"3000000","currency":"INR","outstandingBalance":"6899059"},"cfSerialNumber":"Credit Facility 1","creditFacilityDispute":{"disputeRemarks":"","disputeRemarksDate":""},"lastReportedDate":"09-SEP-2013","cfType":"Unsecured business loan","derivative":"FALSE","cfMember":"Not Disclosed","dates":{"sanctionedDt":"06-FEB-2008"},"accountNumber":"Not Disclosed","assetClassificationDaysPastDueDpd":"Loss","status":"Not a Suit Filed Case,Open,Not Wilful Defaulter"}},"creditFacilityOverdueDetailsVec":{"creditFacilityOverdueDetails":{"DPD1To30Amt":""},"message":"No Amount Overdue Information Reported"},"CFHistoryforACOrDPDupto24MonthsVec":{"CFHistoryforACOrDPDupto24Months":[{"month":"AUG 2013","ACorDPD":"Loss","OSAmount":"2200828"}]},"creditFacilitySecurityDetailsVec":{"message":"No Security Details Reported"},"message":"","creditFacilityGuarantorDetailsVec":{"message":"No Guarantor Details Reported"},"chequeDishounouredDuetoInsufficientFunds":{"message":"No Dishonored Cheques Due To Non Sufficient Funds Reported"}}],"message":""},"creditFacilitiesSummary":{"countOfCreditFacilities":{"noOfCreditGrantors":{"yourBank":"0","total":"0","others":"0"},"noOfCreditFacilities":{"yourBank":"0","total":"0","others":"0"}}},"enquirySummarySec":{"enquiryOutsideInstitution":{"noOfEnquiries":{"month2To3":"73","month4To6":"81","month1":"62","total":"385","month12To24":"91","mostRecentDate":"19-DEC-2023","greaterthan24Month":"20","month7To12":"58"}},"enquiryYourInstitution":{"noOfEnquiries":{"month2To3":"0","month4To6":"0","month1":"8","total":"8","month12To24":"0","mostRecentDate":"20-DEC-2023","greaterthan24Month":"0","month7To12":"0"}},"message":"","enquiryTotal":{"noOfEnquiries":{"month2To3":"73","month4To6":"81","month1":"70","total":"393","month12To24":"91","mostRecentDate":"","greaterthan24Month":"20","month7To12":"58"}}},"creditVisionSec":{},"creditProfileSummarySec":{"total":{"latestCFOpenedDate":"-","totalOutstanding":"129050377","totalCF":"41","delinquentOutstanding":"50461253","delinquentCF":"9","openCF":"22","totalLenders":"14"},"yourInstitution":{"latestCFOpenedDate":"","totalOutstanding":{"borrowerPercentage":"0.00%","borrower":"0","guarantor":"0","guarantorPercentage":"0.00%"},"totalCF":{"borrowerPercentage":"","borrower":"0","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"0.00%","borrower":"0","guarantor":"0","guarantorPercentage":"0.00%"},"message":"No Credit Facility Reported by Your Institution","delinquentCF":{"borrowerPercentage":"","borrower":"0","guarantor":"0","guarantorPercentage":""},"openCF":"0","totalLenders":"0"},"outsideInstitution":{"outsideTotal":{"latestCFOpenedDate":"-","totalOutstanding":{"borrowerPercentage":"100.00%","borrower":"129050377","guarantor":"0","guarantorPercentage":"0.00%"},"totalCF":{"borrowerPercentage":"","borrower":"41","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"100.00%","borrower":"50461253","guarantor":"0","guarantorPercentage":"0.00%"},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"9","guarantor":"0","guarantorPercentage":""},"openCF":"22","totalLenders":"14"},"message":"","otherPublicSectorBanks":{"latestCFOpenedDate":"18-JUN-2009","totalOutstanding":{"borrowerPercentage":"","borrower":"76601121","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"8","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"257991","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"2","guarantor":"0","guarantorPercentage":""},"openCF":"6","totalLenders":"2"},"otherPrivateForeignBanks":{"latestCFOpenedDate":"29-SEP-2008","totalOutstanding":{"borrowerPercentage":"","borrower":"40723917","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"27","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"38477923","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"4","guarantor":"0","guarantorPercentage":""},"openCF":"13","totalLenders":"8"},"NBFCOthers":{"latestCFOpenedDate":"10-NOV-2016","totalOutstanding":{"borrowerPercentage":"","borrower":"11725339","guarantor":"0","guarantorPercentage":""},"totalCF":{"borrowerPercentage":"","borrower":"6","guarantor":"0","guarantorPercentage":""},"delinquentOutstanding":{"borrowerPercentage":"","borrower":"11725339","guarantor":"0","guarantorPercentage":""},"message":"","delinquentCF":{"borrowerPercentage":"","borrower":"3","guarantor":"0","guarantorPercentage":""},"openCF":"3","totalLenders":"4"}}},"creditRatingSummaryVec":{"message":"No Credit Rating Information Reported"},"creditFacilityDetailsasGuarantorVec":{"message":"No Guaranteed Credit Facility Information Reported"},"oustandingBalanceByCFAndAssetClasificationSec":{"yourInstitution":{"total":{"NONSTDVec":{"sub":{"count":"0","value":"0"},"loss":{"count":"0","value":"0"},"DPD91To180":{"count":"0","value":"0"},"dbt":{"count":"0","value":"0"}},"STDVec":{"DPD61To90":{"count":"0","value":"0"},"DPD1To30":{"count":"0","value":"0"},"DPD0":{"count":"0","value":"0"},"DPD31To60":{"count":"0","value":"0"}}},"termLoan":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"workingCapital":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"forex":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"nonFunded":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}}},"message":"","outsideInstitution":{"total":{"NONSTDVec":{"sub":{"count":"1","value":"1163443"},"loss":{"count":"7","value":"18459484"},"DPD91To180":{"count":"0","value":"0"},"dbt":{"count":"2","value":"257991"}},"STDVec":{"DPD61To90":{"count":"0","value":"0"},"DPD1To30":{"count":"0","value":"0"},"DPD0":{"count":"24","value":"79816385"},"DPD31To60":{"count":"0","value":"0"}}},"termLoan":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"2","value":"2200043"},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"8","value":"5892662"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"3","value":"1227261"},"DPD31To60":{"count":"","value":""}}},"workingCapital":{"NONSTDVec":{"sub":{"count":"1","value":"1163443"},"loss":{"count":"5","value":"16259441"},"DPD91To180":{"count":"","value":""},"dbt":{"count":"2","value":"257991"}},"total":{"count":"29","value":"136839129"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"17","value":"78589124"},"DPD31To60":{"count":"","value":""}}},"forex":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"0","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"","value":""},"DPD31To60":{"count":"","value":""}}},"nonFunded":{"NONSTDVec":{"sub":{"count":"","value":""},"loss":{"count":"","value":""},"DPD91To180":{"count":"","value":""},"dbt":{"count":"","value":""}},"total":{"count":"4","value":"0"},"STDVec":{"DPD61To90":{"count":"","value":""},"DPD1To30":{"count":"","value":""},"DPD0":{"count":"4","value":"0"},"DPD31To60":{"count":"","value":""}}}}}}}},"BUREAU":"CIBIL"}]}';
        CommercialIssueResponseWrapper request = CommercialIssueResponseWrapper.parse(jsonresponse);
    }

}